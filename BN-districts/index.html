<!DOCTYPE html>
<html>
  <head>
    <title>OSM Map: Districts of Bonn</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.min.css" />
    <link rel="stylesheet" href="../css/leaflet.min.css" />
    <link rel="stylesheet" href="../css/Control.FullScreen.min.css" />
    <script src="../js/leaflet.js"></script>
    <script src="../js/Control.FullScreen.min.js"></script>
    <script src="../js/leaflet-tilelayer-colorfilter.min.js"></script>
    <script src="../js/BoundaryCanvas.min.js"></script>
    <style>
      body {
        bottom: 0;
        left: 0;
        margin: 0;
        padding: 0;
        position: absolute;
        right: 0;
        top: 0;
      }
      .title {
        font-family: sans-serif;
        font-size: 24px;
        font-weight: bold;
        height: 48px;
        line-height: 48px;
        margin: 0;
        text-align: center;
        width: 100%;
      }
      .content {
        height: calc( 100% - 48px );
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="title">OSM Map: Districts of Bonn</div>
    <div class="content" id="mapid"></div>
    <script>
      var map
      function addMap() {
        if (remainingLoads) {
          window.setTimeout(addMap, 100)
        } else {
          map = L.map('mapid', {
            fullscreenControl: true,
            fullscreenControlOptions: {
              position: 'topleft'
            },
            layers: [baseMaps['BW']]
          }).fitBounds([
            [50.632, 7.022],
            [50.775, 7.211]
          ])
          L.control.layers(baseMaps, overlayMaps).addTo(map)
        }
      }
      var attribution = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
            '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
      var baseMaps = {
        'OSM': L.tileLayer('https://mapintosh.de/tiles/osm/{z}/{x}/{y}.png', {
          maxZoom: 18,
          attribution: attribution
        }),
        'BW': L.tileLayer.colorFilter('https://mapintosh.de/tiles/osm/{z}/{x}/{y}.png', {
          maxZoom: 18,
          attribution: attribution,
          filter: [
            'blur: 0.5px',
            'grayscale: 60%',
            'opacity: 30%'
          ]
        })
      }
      var fileNames = ['Bad_Godesberg', 'Beuel', 'Bonn', 'Hardtberg']
      var remainingLoads = fileNames.length
      var overlayMaps = { }

      fileNames.forEach(fileName =>
        fetch('geoJSON/' + fileName + '.min.geojson')
          .then(response => response.json())
          .then(geoJSON => {
            overlayMaps[fileName + '-border'] = L.geoJSON(geoJSON, {
              style: {
                color: '#000099',
                fill: false,
                opacity: 0.5,
                weight: 1
              }
            })
            overlayMaps[fileName + '-area'] = L.TileLayer.BoundaryCanvas.createFromLayer(baseMaps.OSM, {
              boundary: geoJSON
            })
            remainingLoads--
          })
      )
      addMap()
    </script>
  </body>
</html>

